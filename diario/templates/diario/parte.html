{% load markdownify %}

{% block navegacao %}
<div class="titulo" style="padding-top: 1.25rem;margin-top: 5px;">
    <div class="topo-exercicio">
        <div class="bcca-breadcrumb">
            {% if sessaoGrupo.grupo.programa == "CARE" %}
                {% if parteGrupo.concluido == False  and parte.id == proxima_parte and parteGrupo.inicio != None and parte.fase != parte.FINAL and grupos_permissoes.exists %}
                    <form action="{% url 'diario:finalizar_parte' parte.id sessaoGrupo.id 'finalizar'%}" method="POST">
                        {% csrf_token %}
                        <div class="bcca-breadcrumb-item-last fw-normal fs-4"><button>Terminar Parte</button></div>
                    </form>
                {% elif parteGrupo.concluido == False  and parte.id == proxima_parte and parteGrupo.inicio != None and parte.fase == parte.FINAL and grupos_permissoes.exists %}
                    <form action="{% url 'diario:finalizar_sessao' sessaoGrupo.grupo.id sessaoGrupo.id %}" method="POST">
                        {% csrf_token %}
                        <div class="bcca-breadcrumb-item-last fw-normal fs-4"><button>Terminar Sess√£o</button></div>
                    </form>
                {% endif %}
            {% else %}
                {% if parteGrupo.concluido == False  and exercicio.id == proxima_parte and parteGrupo.inicio != None %}
                    <form action="{% url 'diario:finalizar_parte' exercicio.id sessaoGrupo.id 'finalizar'%}" method="POST">
                        {% csrf_token %}
                        <div class="bcca-breadcrumb-item-last fw-normal fs-4"><button>Terminar Parte</button></div>
                    </form>
                {% endif %}
            {% endif %}

            {% if sessaoGrupo.grupo.programa == "CARE" %}
                <form action="{% url 'diario:finalizar_parte' parte.id sessaoGrupo.id 'continuar' %}" method="POST">
                    {% csrf_token %}
                    <div class="bcca-breadcrumb-item fw-normal fs-4">
                        <button>&ensp; {{sessaoGrupo.grupo.programa}} {{sessaoGrupo.sessao.numeroSessao}} &nbsp;</button>
                    </div>
                </form>
            {% elif sessaoGrupo.grupo.programa == "COG" %}
                <form action="{% url 'diario:finalizar_parte' exercicio.id sessaoGrupo.id 'continuar' %}" method="POST">
                    {% csrf_token %}
                    <div class="bcca-breadcrumb-item fw-normal fs-4">
                        <button>&ensp; {{sessaoGrupo.grupo.programa}} {{sessaoGrupo.sessao.numeroSessao}}</button>
                    </div>
                </form>
            {% endif %}

            <div class="bcca-breadcrumb-item fw-normal fs-4">
                <a href="{% url 'diario:group_sessions' sessaoGrupo.grupo.id %}" >
                    Sess√µes
                </a>
            </div>
            <div class="bcca-breadcrumb-item fw-normal fs-4">
                <a href="{% url 'diario:grupo_details' sessaoGrupo.grupo.id %}">
                    {{sessaoGrupo.grupo}}
                </a>
            </div>
          </div>

          <div style="width:250px" class="esquerda">
            {% if parteGrupo.duracao_minutos > dura %}
                <div style="width:100%; height:40px;" class="progress">
                    <div id="timer" class="progress-bar" role="progressbar"
                            style="width: {{ parteGrupo.duracao_minutos }}%; background-color: #4eb4be"
                            aria-valuenow="{{ parteGrupo.duracao_minutos }}" aria-valuemin="0"
                            aria-valuemax="{{ dura }}">
                            {{ duracao_segundos }}
                    </div>
                </div>
            {% else %}
                <div style="width:100%; height:40px;" class="progress">
                    <div id="timer" class="progress-bar" role="progressbar"
                            style="width: {{ parteGrupo.duracao_minutos }}%;"
                            aria-valuenow="{{ parteGrupo.duracao_minutos }}" aria-valuemin="0"
                            aria-valuemax="{{ dura }}">
                            {{ duracao_segundos }}

                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% if sessaoGrupo.grupo.programa == "CARE"%}
    <h5 class="m-0 fw-bold mb-text fs-5">Objetivo</h5>
    <span>{{ parte.objetivo }}</span>


    <h5 class="m-0 fw-bold mb-text fs-4 mt-4">Sum√°rio</h5>

    {{ parte.descricao | markdownify }}</span>
    {% if parte.materiais|length > 0 %}

        <h5 class="m-0 fw-bold mb-text fs-5 mt-4">Materiais</h5>
        <span class="">{{ parte.materiais | markdownify }}</span>

    {% endif %}


    {% if parte.apresentacao|length > 0 %}
    <h5 class="m-0 fw-bold mb-text fs-5 mt-4">Apresenta√ß√£o</h5>
    <ul class="">
        <li>
            <a href="{{ parte.apresentacao.url }}">
                Descarregar apresenta√ß√£o üìÉ
            </a>
        </li>
    </ul>
    {% endif %}

    {% if parte.atividades.all|length > 0 %}

    <h5 class="m-0 fw-bold mb-text fs-5 mt-4">Atividades</h5>
    {% for atividade in parte.atividades.all %}

    <span class="">Atividade {{ atividade.numero }} - {{ atividade.nome }}</span>

    <span class="">
    {{ atividade.descricao | markdownify }}
    </span>
    {% endfor %}
    {% endif %}

    {% if parte.questionarios.all|length > 0 %}

        <h5 class="m-0 fw-bold mb-text fs-5 mt-4">Questionario</h5>

        <ul class="">
        {% for qu in parte.questionarios.all %}
        <li>
        <a href="{% url 'diario:view_abrirQuestionario' qu.id parte.id sessaoGrupo.id  %}">
            <button type="button" class="btn mb-btn-outline btn-sm" style="margin:5px" data-parte="{{qu.id}}"><i class="fa-solid fa-clipboard-question"></i> Question√°rio {{ qu.numeroOrdem }}</button>
        </a>
        </li>
        {% endfor %}
        </ul>

    {% endif %}
{% elif sessaoGrupo.grupo.programa == "COG" %}
<div class="side-by-side">
    <div class="esquerda">
        <h5 class=" m-0 fw-bold">
        {% if exercicio.numero > 0 %}
            Exerc√≠cio {{ exercicio.numero}} - {{exercicio.dominio }}
        {% else %}
            {{ exercicio.dominio }}
        {% endif %}
        </h5>
    </div>
    <div style ="width:25%" class="direita">
        {% if estado != "ver" %}
            <h5 class=" m-6 fw-bold">
                Dura√ß√£o
                <span class=" m-6 fw-normal text-muted">
                    {{ dura }} minutos
                </span>
            </h5>
            {% if parteGrupo.duracao_minutos > dura %}
                <div style ="width:100%; margin-top: 5px;"class="progress">
                    <div id= "timer" class="progress-bar" role="progressbar" style="width: {{ parteGrupo.duracao_minutos }}%; background-color: #dc3545" aria-valuenow="{{ parteGrupo.duracao_minutos }}" aria-valuemin="0" aria-valuemax="{{dura}}">
                        {{ parteGrupo.duracao_minutos }}m
                    </div>
                </div>
            {% else %}
                <div style ="width:100%; margin-top: 5px;"class="progress">
                    <div id= "timer" class="progress-bar" role="progressbar" style="width: {{ parteGrupo.duracao_minutos }}%;" aria-valuenow="{{ parteGrupo.duracao_minutos }}" aria-valuemin="0" aria-valuemax="{{dura}}">
                        {{ parteGrupo.duracao_minutos }}m
                    </div>
                </div>
            {% endif %}
        {% elif estado == "ver" %}
            {% if parteGrupo.concluido %}
            <h5 class=" m-6 fw-bold">
                Dura√ß√£o
                <span class=" m-6 fw-normal text-muted">
                    {{ parteGrupo.duracao_em_horas_minutos }} de {{ dura }} minutos
                </span>
            </h5>
            {% else %}
            <h5 class=" m-6 fw-bold">
                Dura√ß√£o
                <span class=" m-6 fw-normal text-muted">
                    {{ dura }} minutos
                </span>
            </h5>
            {% endif %}
        {% endif %}
    </div>
</div>
<div style= "padding-top:15px;" id="accordion">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn btn-link no-decor m-0 fw-bold mb-text fs-5" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            Material
          </button>
        </h5>
      </div>

      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
        <div class="card-body">
          {{ exercicio.material | markdownify }}
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed no-decor m-0 fw-bold mb-text fs-5" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Instru√ß√£o
          </button>
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">
        <div class="card-body">
        {{ exercicio.instrucao | markdownify }}
        </div>
      </div>
    </div>
</div>
<div class="partes-exercicio">
    <a href="{% url 'diario:parte_ativa' sessaoGrupo.id %}" target="_blank">
    <i style="margin-top:15px;margin-right:15px;float:right;text-size:30px"class="fas fa-window-restore"></i>
    </a>
    <div id="carousel" class="carousel slide" data-ride="carousel" style="height: 100%;">
        <ol class="carousel-indicators">
            {% for parte in exercicio_partes %}
            <li data-target="#carousel" data-parte="{{parte.id}}" data-slide-to="{{forloop.counter0}}" {% if forloop.counter0 == 0 %}class="active"{% endif %}></li>
            {% endfor %}
        </ol>
        <div class="carousel-inner">
        {% for parte in exercicio_partes %}
            <div class="carousel-item {% if forloop.counter0 == 0 %}active {% endif %}">
            {% if parte.imagens.all|length > 0 %}
            <div class = "exercicio-imagens">
                {% for imagem in parte.imagens.all %}
                <br>
                <a target="_blank" href="{{ imagem.imagem.url }}">
                    <img class="img-preview" src="{{ imagem.imagem.url }}">
                </a>
                {% endfor %}
            </div>
            <br>
            {% endif %}

            {% if parte.descricao|length > 0 %}

            <div style ="padding-bottom: 3%;"class = "exercicio-descricao center
            {% if parte.descricao|length > 150 %}
            h5
            {% else %}
            h4
            {% endif %}
            ">
                {{ parte.descricao|markdownify }}
            </div>
            {% endif %}

            {% if parte.perguntas.all|length > 0%}
                {% csrf_token %}
                <div class = "flex-container">
                {% for pergunta in parte.perguntas.all %}
                <div class = "exercicio-pergunta form-group right" style="{%if pergunta.tipo_resposta == "UPLOAD_FOTOGRAFIA" %} flex-direction: column {% else %} flex-direction: row {% endif %}">
                    {% if pergunta.dificuldade == "A" or pergunta.dificuldade == "B" %}
                        <div class ="left text-primary h3">
                            {{ pergunta.dificuldade }}
                        </div>
                        {% endif%}

                    {% for perg,parte_ordem,form in form_list %}
                        {% if perg == pergunta and parte_ordem == parte.ordem %}
                            {% if pergunta.tipo_resposta == 'UPLOAD_FOTOGRAFIA' %}
                                <form action="preventDefault()" enctype="multipart/form-data">
                                    {% for field in form %}
                                        <label>{{ pergunta.nome }}</label>
                                        <div>
                                            {{ field }}
                                            <span style="display:none">{{perg.id}}</span>
                                            <span style="display:none">{{parte.id}}</span>
                                        </div>
                                    {% endfor %}
                                </form>
                            {% elif pergunta.tipo_resposta == 'ESCOLHA_MULTIPLA' %}
                                {% include 'diario/escolha_multipla.html' %}
                            {% else %}
                                {% for field in form %}
                                    <label>{{ pergunta.nome }}</label>
                                    <div>
                                        {{ field }}
                                        <span style="display:none">{{perg.id}}</span>
                                        <span style="display:none">{{parte.id}}</span>
                                    </div>
                                    {% if pergunta.postexto %}
                                    <label>
                                        {{ pergunta.postexto }}
                                    </label>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>

                {% endfor %}
                <button onclick="submete({{sessaoGrupo.id}},{{parteGrupo.id}},{{participante.id}})" type="button" class="btn btn-primary">Submeter</button>

            </div>
            {% endif %}

            </div>
        {% endfor %}
        </div>
        <button class = "btn btn-danger botao-partilha" onclick="ativa_partilha({{sessaoGrupo.id}})">Partilhar</button>
    </div>
</div>
{% endif %}


<br>


<br>

